(function($){Zendesk.embeddedInLotusAdmin=function(){return window.name=="zendesk-clean-admin"};Zendesk.embeddedInLotusLaunchpad=function(){return window.name=="lotus-launchpad"};var document=this.document,embeddedInLotus=Zendesk.embeddedInLotusAdmin();var lotusHrefs={"^/rules/(\\d+)$":"#/filters/$1","^/tickets/(\\d+)":"#/tickets/$1","^/users/new":"#/users/new","^/users/(\\d+)$":"#/users/$1","^/users/(\\d+)/edit":"#/users/$1","^/organizations/(\\d+)(/edit)?":"#/organizations/$1","^/organizations/new":"#/organizations/new","^/settings/account#subscription/lotus":"#/admin/subscription","^/agent/admin/business_hours":"#/admin/business_hours","^/agent/admin/widget":"#/admin/widget","^/agent/admin/brands":"#/admin/brands"};var rewrittenLotusHrefs=[/#\/filters\/\d+/,/#\/tickets\/\d+/,/#\/users\/new/,/#\/users\/\d+/,/#\/organizations\/\d+/,/#\/organizations\/new/,/#\/admin\/subscription/,/#\/admin\/business_hours/,/#\/admin\/widget/,/#\/admin\/brands/];var forumHref=new RegExp("^/entries/");var chatHref=new RegExp("/chat");function lotusHref(href){var regex;for(var r in lotusHrefs){if(lotusHrefs.hasOwnProperty(r)){regex=new RegExp(r);if(regex.test(href)){return href.replace(regex,lotusHrefs[r])}}}for(var i=0;i<rewrittenLotusHrefs.length;i++){if(rewrittenLotusHrefs[i].test(href)){var split=href.split("#");return"#"+split[split.length-1]}}return null}function appendLotusQueryParams(elem){var href=elem.attr("href");var param="lotus=true";var join_with;if(href.indexOf(param)>-1){return}if(href.indexOf("?")>-1){join_with="&"}else{join_with="?"}elem.attr("href",href+join_with+param);elem.prop("href",href+join_with+param)}function rewriteHrefOnMouseDown(evt){var $a=$(this),lotusLink=lotusHref($a.attr("href")),forumLink=forumHref.test($a.attr("href")),chatLink=chatHref.test($a.attr("href"));if(lotusLink){if(embeddedInLotus){rewriteLinkToLotus($a,"_top")}else{if(currentUser.isAgent&&currentAccount.doAgentsPreferLotus){rewriteLinkToLotus($a,"_blank")}}}else{if(embeddedInLotus&&chatLink){appendLotusQueryParams($a)}else{if(embeddedInLotus&&forumLink){$a.attr("target","_blank")}}}}function handlePossibleLotusClick(evt){if(evt.metaKey||evt.ctrlKey){return}var $a=$(this),lotusLink=lotusHref($a.attr("href")),forumLink=forumHref.test($a.attr("href")),chatLink=chatHref.test($a.attr("href"));if(lotusLink){if(embeddedInLotus){transitionToLotus($a,evt)}else{if(currentUser.isAgent&&currentAccount.doAgentsPreferLotus){rewriteLinkToLotus($a,"_blank")}}}else{if(embeddedInLotus&&chatLink){appendLotusQueryParams($a)}else{if(embeddedInLotus&&forumLink){$a.attr("target","_blank")}}}}function origin(location){return location.origin||location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")}function transitionToLotus(element,event){var $element=$(element),split=lotusHref($element.attr("href")).split("#"),href=split[split.length-1];event.preventDefault();var data=JSON.stringify({target:"route",memo:{hash:href}});window.parent.postMessage(data,origin(location))}function rewriteLinkToLotus(elem,target){var $elem=$(elem),envIsDev=(currentAccount.domain=="localhost")?true:false,topDomain=(envIsDev)?"localhost:3000":currentAccount.domain,protocol=(envIsDev)?"http://":"https://",accountUrl=protocol+currentAccount.subdomain+"."+topDomain+"/agent/",lotus=accountUrl+lotusHref($elem.attr("href"));$elem.attr("target",target).attr("href",lotus).prop("href",lotus)}$(function(){$(document).delegate("a","click",handlePossibleLotusClick);$(document).delegate("a","mouseover",rewriteHrefOnMouseDown);if(Zendesk.embeddedInLotusAdmin()){$("body").addClass("embedded_in_lotus")}})}(this.jQuery));